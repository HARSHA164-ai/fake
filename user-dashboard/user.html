<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard | Andhra Developers</title>

    <!-- Bootstrap 5 & Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            color: #212529;
        }

        .dark-mode {
            background-color: #121212;
            color: #f1f1f1;
        }

        header {
            background-color: #0d6efd;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1050;
        }

        .toggle-sidebar-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            margin-right: 1rem;
            cursor: pointer;
        }

        .sidebar {
            position: fixed;
            width: 260px;
            height: 100vh;
            background-color: #fff;
            border-right: 1px solid #ddd;
            padding-top: 2rem;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1040;
            overflow-y: auto;
        }

        .sidebar.visible {
            transform: translateX(0);
        }

        .dark-mode .sidebar {
            background-color: #1e1e1e;
            border-color: #333;
        }

        .sidebar a {
            display: block;
            padding: 0.75rem 1.5rem;
            color: #212529;
            text-decoration: none;
        }

        .sidebar a:hover {
            background-color: #e9ecef;
        }

        .dark-mode .sidebar a {
            color: #ccc;
        }

        .dark-mode .sidebar a:hover {
            background-color: #2a2a2a;
        }

        .main-content {
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        @media (min-width: 768px) {
            .sidebar.visible~.main-content {
                margin-left: 260px;
            }
        }

        .course-card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: white;
        }

        .dark-mode .course-card {
            background-color: #1e1e1e;
            border-color: #333;
        }

        .btn-enroll {
            float: right;
        }
    </style>
</head>

<body>
    <header>
        <div class="d-flex align-items-center">
            <button class="toggle-sidebar-btn" id="toggleSidebar">
                <i class="fas fa-bars"></i>
            </button>
            <span class="fw-bold fs-5">Andhra Developers</span>
        </div>
        <button class="btn btn-light" id="darkModeToggle"><i class="fas fa-moon"></i></button>
    </header>

    <div class="sidebar" id="sidebar">
        <h5 class="text-center">üë®‚Äçüíª Andhra Developers</h5>
        <a href="#"><i class="fas fa-home me-2"></i> Dashboard</a>
        <a href="#"><i class="fas fa-book me-2"></i> Courses</a>
        <a href="#"><i class="fas fa-tasks me-2"></i> Enrolled</a>
        <a href="#"><i class="fas fa-calendar-alt me-2"></i> Events</a>
        <a href="#"><i class="fas fa-bell me-2"></i> Notifications</a>
        <a href="#"><i class="fas fa-certificate me-2"></i> Certificates</a>
    </div>

    <div class="main-content" id="mainContent">
        <section id="dashboardSection">
            <h2>Welcome, <span id="userName">User</span></h2>
            <span id="userEmail">user@example.com</span>
            <hr>
            <p>This is the Dashboard content.</p>
        </section>

        <section id="coursesSection" style="display: none;">
            <h2>Courses</h2>
            <input type="text" id="courseSearch" class="form-control mb-3" placeholder="Search courses...">
            <div id="coursesList">Loading...</div>
        </section>

        <section id="enrolledSection" style="display: none;">
            <h2>Enrolled Courses</h2>
            <p>Courses you're enrolled in.</p>
        </section>

        <section id="eventsSection" style="display: none;">
            <h2>Events</h2>
            <p>Upcoming events and schedules.</p>
        </section>

        <section id="notificationsSection" style="display: none;">
            <h2>Notifications</h2>
            <p>All latest updates.</p>
        </section>

        <section id="certificatesSection" style="display: none;">
            <h2>Certificates</h2>
            <p>Download your earned certificates.</p>
        </section>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC9BtE5OnvtHd1EsN6Ag_InBy1r3S1VM7U",
            authDomain: "ad2026-b18de.firebaseapp.com",
            projectId: "ad2026-b18de",
            storageBucket: "ad2026-b18de.appspot.com",
            messagingSenderId: "837618240318",
            appId: "1:837618240318:web:8c3fedc57c3cb3e711fa6f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <!-- App Logic -->
    <!-- Replace inside your existing <script> tag at the bottom -->
<script>
    const body = document.body;
    const darkToggle = document.getElementById("darkModeToggle");
    const sidebar = document.getElementById("sidebar");
    const toggleSidebarBtn = document.getElementById("toggleSidebar");

    if (localStorage.getItem("darkMode") === "enabled") {
        body.classList.add("dark-mode");
    }

    darkToggle.addEventListener("click", () => {
        body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", body.classList.contains("dark-mode") ? "enabled" : "disabled");
    });

    toggleSidebarBtn.addEventListener("click", () => {
        sidebar.classList.toggle("visible");
    });

    // Firebase Auth: Ensure user is logged in
    firebase.auth().onAuthStateChanged((user) => {
        if (user) {
            document.getElementById("userName").textContent = user.displayName || "User";
            document.getElementById("userEmail").textContent = user.email;
        } else {
            alert("Please sign in to use the dashboard.");
            window.location.href = "/login.html";
        }
    });

    const navLinks = document.querySelectorAll(".sidebar a");
    const sections = document.querySelectorAll(".main-content section");

    navLinks.forEach(link => {
        link.addEventListener("click", (e) => {
            e.preventDefault();
            const target = link.textContent.trim().toLowerCase() + "Section";
            sections.forEach(section => {
                section.style.display = section.id === target ? "block" : "none";
            });
            if (target === "coursesSection") loadCourses();
        });
    });

    // üß† Load courses and render cards
    function loadCourses() {
        const container = document.getElementById("coursesList");
        const searchInput = document.getElementById("courseSearch");

        db.collection("courses").onSnapshot(snapshot => {
            let courses = [];
            snapshot.forEach(doc => {
                courses.push({ id: doc.id, ...doc.data() });
            });

            function renderCourses(filter = "") {
                let html = "";
                const filtered = courses.filter(c => c.title.toLowerCase().includes(filter.toLowerCase()));
                if (filtered.length === 0) {
                    html = "<p>No courses found.</p>";
                } else {
                    filtered.forEach(course => {
                        html += `
                            <div class="course-card">
                                <h5>${course.title}</h5>
                                <p>${course.description}</p>
                                <button class="btn btn-primary btn-sm btn-enroll"
                                    onclick="requestEnrollment('${course.id}', '${course.title}')">
                                    Request Enroll
                                </button>
                            </div>
                        `;
                    });
                }
                container.innerHTML = html;
            }

            renderCourses();

            searchInput.addEventListener("input", () => {
                renderCourses(searchInput.value);
            });
        });
    }

    // üöÄ Function to request enrollment in Firestore
    function requestEnrollment(courseId, courseTitle) {
        const user = firebase.auth().currentUser;
        if (!user) {
            alert("Please log in first.");
            return;
        }

        const requestRef = db.collection("course_requests");

        // Save the request
        requestRef.add({
            userId: user.uid,
            courseId: courseId,
            status: "pending",
            requestedAt: new Date()
        }).then(() => {
            alert(`Enrollment request sent for: ${courseTitle}`);
        }).catch(error => {
            console.error("Enrollment request error:", error);
            alert("Failed to send request. Try again.");
        });
    }
</script>

</body>

</html>
